{% extends '../header.html' %}
{% load static %}
{% block content %}

{% include './auth_header.html' %}

<div>     
        <div style="padding: 15px 30px; display: flex; gap: 2rem;">
            {% include 'travel/admin/dialogs/agentacc__new_agent.html' %}
            
            <div class="uk-width-1-4" style="min-height: 100vh; border-radius: 43px; box-shadow: 0px 4px 78px 0px #0000001A; padding: 1rem;">
                <div class="uk-flex" style="justify-content: space-evenly; align-items: center; padding: 1.3rem 0;">
                    <p style="display: inline-block; font-size: 2rem; font-weight: 600; margin: 0;">Agents Listing</p>
                    <img class="btn" uk-toggle="target: #vbs-travel-new-agent" src="{% static 'img/zondicons_add-solid.png' %}" style="width:42px; height:42px;" />
                </div>
                <div style="display: flex; gap: 1rem; flex-direction: column;"> 
                        {% for i in agents_list %}

                        <div style="height: 80px; border-radius: 21px; display: flex; align-items: center; justify-content: space-between; padding: 1rem 3rem; gap:.5rem; box-shadow: 0px 4px 14px 0px #00000040;">
                            <span style="font-size: 1.5rem; color: #0077BB; font-weight:500; text-transform: capitalize">{{i.employee_auth_user_ref.first_name }} {{i.employee_auth_user_ref.last_name }}</span>
                            <img class="btn" onClick='clicked(this, {{i.id}})' src="{% static 'img/carbon_arrow-up-purple.png' %}" style="width:50px; height:50px;" />
                        </div>

                        {% endfor %}
                    </div>
            </div>

            <div class="uk-flex" style=" flex-direction: column; row-gap: 1.5rem; flex-grow: 1;">
                    <div class="uk-card uk-card-default uk-card-body" style="min-height: 60vh; border-radius: 43px; display: flex; align-items: center; justify-content: center; text-align: center;">
                            <div id="client-not-selected">
                                <img src="{% static 'img/la_hand-pointer.png' %}" style="width:50px; height:50px; margin-bottom: 1rem;" /><br/>
                                <span style="font-size:1.5rem; color: #D0D0D0; width: 70%; display: inline-block;">
                                    No agent selected. Please select the agent to view the records
                                </span>
                            </div> 
                            <div id="client_details" style="width:100%; display:none;"></div>
                    </div>
            
                    <div class="uk-card uk-card-default uk-card-body" style="padding-bottom: 2rem; border-radius: 43px; display: flex; align-items: flex-start; justify-content: left; width: 70vw;">
                        <div style="text-align: left; padding-left: 3%; width: 100%;">   
                            <h4 style="font-size: 1.7rem; font-weight: 400;">Agent's pending application</h4>
                            <div uk-slider style="width: 100%;">
                                <ul id="pending-applications" class="uk-slider-items uk-flex" style="gap: 1.5rem; list-style:none;justify-content: center;">
                                    <div style="text-align: center; margin-left: 5rem;">
                                        <img src="{% static 'img/la_hand-pointer.png' %}" style="width:50px; height:50px; margin-bottom: 1rem;" /><br/>
                                        <span style="font-size:1.5rem; color: #D0D0D0; width: 70%; display: inline-block;">
                                            No Agent selected. Please select the Agent to view the records
                                        </span>
                                    </div>
                                </ul>
                            </div>
                        </div>
                    </div>
                
                    <div class="uk-card uk-card-default uk-card-body" style="padding-bottom: 2rem; border-radius: 43px; display: flex; align-items: flex-start; justify-content: left; width: 70vw;">
                        <div style="text-align: left; padding-left: 3%; width: 100%;">   
                            <h4 style="font-size: 1.7rem; font-weight: 400;">Agent's pending applications at Payments stage</h4>
                            <div uk-slider style="width: 100%;">
                                <ul id="application-payment" class="uk-slider-items uk-flex" style="gap: 1.5rem; list-style:none; justify-content: center;">
                                    <div style="text-align: center; margin-left: 5rem;">
                                        <img src="{% static 'img/la_hand-pointer.png' %}" style="width:50px; height:50px; margin-bottom: 1rem;" /><br/>
                                        <span style="font-size:1.5rem; color: #D0D0D0; width: 70%; display: inline-block;">
                                            No Agent selected. Please select the Agent to view the records
                                        </span>
                                    </div>
                                </ul>
                            </div>
                        </div>
                    </div>

            </div>

    </div>
</div>
    <script>
        const client_details = document.getElementById("client_details")
        const client_not_selected = document.getElementById("client-not-selected")
        const pending_applications = document.getElementById("pending-applications")
        const application_payment = document.getElementById("application-payment")

        var prevBtn = ""

        var agents_name = ""

        function clicked(e, id) {

            if(id !== null){
                $.ajax({
                    url: `http://localhost:8000/travel/api/agent_details/${id}`,
                    type: 'GET',
                    success: function(data){
                        console.log('api run response', data)
                        client_not_selected.classList.add('not-visible')
                        e.parentElement.classList.add('uk-tile-primary')
                        e.previousElementSibling.style="font-size: 1.5rem; color: #fff; font-weight:500; text-transform: capitalize"
                        e.src="{% static 'img/carbon_arrow-up.png' %}"
                        if(prevBtn !== ""){
                            prevBtn.parentElement.classList.remove('uk-tile-primary')
                            prevBtn.previousElementSibling.style="font-size: 1.5rem; color: #0077BB; font-weight:500; text-transform: capitalize"
                            prevBtn.src="{% static 'img/carbon_arrow-up-purple.png' %}"
                        }
                        prevBtn = e

                        agents_name = data?.data[0][0]?.employee_auth_user_ref?.first_name + " " + data?.data[0][0]?.employee_auth_user_ref?.last_name

                        client_details.classList.add('visible')

                        if(data?.data[1].length === 0 && data?.data[2].length === 0 && data?.data[3].length === 0){
                            client_details.innerHTML = `<div id="client-not-selected">
                                <img src="{% static 'img/la_hand-pointer.png' %}" style="width:50px; height:50px; margin-bottom: 1rem;" /><br/>
                                <span style="font-size:1.5rem; color: #D0D0D0; width: 70%; display: inline-block;">
                                    No applications at the moment for ${agents_name}.<br /> Please try again later.
                                </span>
                            </div>`
                        }else{

                            client_details.innerHTML = `<div style="width: 100%; height: 100%;">
                                <h4 style="color: #0077BB; font-size: 32px; font-weight:700;">${agents_name}</h4>
    
                                <div class="uk-flex" style="gap: 2rem; justify-content: center;">
                                    <div>
                                        <div class="" style="width: 203px; height: 150px;
                                        border-radius: 21px;border: 1px solid #00AE31;display: flex; align-items: center; justify-content: center; flex-direction: column;">
                                            <span style="color: #00AE31; font-size: 64px; font-weight: 700;">${data?.data[1].length}</span>
                                            <span style="color: #00AE31; font-size: 24px; font-weight: 700;">Total VISAs</span>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="" style="width: 203px; height: 150px;
                                        border-radius: 21px;border: 1px solid #E56509;display: flex; align-items: center; justify-content: center; flex-direction: column;">
                                            <span style="color: #E56509; font-size: 64px; font-weight: 700;">${data?.data[2].length}</span>
                                            <span style="color: #E56509; font-size: 24px; font-weight: 700;">Total Packages</span>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="" style="width: 203px; height: 150px;
                                        border-radius: 21px;border: 1px solid #BD08EA;display: flex; align-items: center; justify-content: center; flex-direction: column;">
                                            <span style="color: #BD08EA; font-size: 64px; font-weight: 700;">${data?.data[3].length}</span>
                                            <span style="color: #BD08EA; font-size: 24px; font-weight: 700;">Total Tickets</span>
                                        </div>
                                    </div>
                                </div>
            
                                <h4 style="font-size: 32px; font-weight:700; color: #0077BB;">All applications handled by ${agents_name}</h4>
                                <br/>
    
                                <div style="max-height: 45vh; overflow-y: scroll; scroll-behavior: smooth; text-align: left;">
                                    <div class="" style="font-size: 20px; font-weight:700; padding: 3%;">
                                        <div uk-grid class="uk-child-width-1-4" style="font-weight: 700; color: #000000;">
                                            <div>Client Name</div>
                                            <div>Category</div>
                                            <div>Stage</div>
                                            <div></div>
                                        </div>
                                    </div>
                                    ${data?.data[1].map(item => `<div class="uk-card uk-card-default" style="height: 82px; background: #F5F5F5; border-radius: 18px; padding: 3%;">
                                        <div uk-grid class="uk-child-width-1-4" style="justify-content: space-between;">
                                            <div style="color: #000000;">${item?.travel_client_ref?.client_name}</div>
                                            <div style="width: 113px; border-radius: 8px; display: flex; background: #00AE31; color: white; align-items: center;"><span style="block">VISA</span></div>
                                            <div style="display: flex; justify-content: center; align-items: center; color: #000000;">${item?.stage}</div>
                                            <div style="display: flex; justify-content: center; align-items: center;"><img class="btn"  uk-toggle="target: #visa-application-details-modal-${item?.id}" src="{% static 'img/carbon_arrow-up-black.png' %}" style="width:32px; height:32px;" /></div>
                                        </div>
                                        <div id="visa-application-details-modal-${item?.id}" uk-modal>
                                            <div class="uk-modal-dialog uk-modal-body">
                                                <button class="uk-modal-close-default" type="button" uk-close></button>
                                                <h2 class="uk-modal-title">Application details</h2>
                                                <input type="hidden" id="id_employee" value=""/>
                                                <div uk-grid class="uk-child-width-1-2">
                                                    <div>
                                                        Applicants Name:<br/>
                                                        <span>${item?.applicants_name}</span>
                                                     </div>
                                                    <div>
                                                        Passport Number:<br/>
                                                        <span>${item?.passport_no}</span>
                                                     </div>
                                                    <div>
                                                        Contact Number:<br/>
                                                        <span>${item?.contact_number}</span>
                                                     </div>
                                                    <div>
                                                        Visiting Country:<br/>
                                                        <span>${item?.visiting_country}</span>
                                                     </div>
                                                     <div>
                                                        Sub Location:<br/>
                                                        <span>${item?.sub_location}</span>
                                                     </div>
                                                    <div>
                                                        Stage:<br/>
                                                        <span>${item?.stage}</span>
                                                     </div>
                                                    <div>
                                                        Application Status:<br/>
                                                        <span>${item?.status}</span>
                                                     </div>
                                                    <div>
                                                        Invoice Status:<br/>
                                                        <span>${item?.invoice_status ? "Paid": "Unpaid"}</span>
                                                     </div>
                                                    <div>
                                                        Total Charges:<br/>
                                                        <span>${item?.total_charges}</span>
                                                     </div>
                                                    <div>
                                                        VBS Charges:<br/>
                                                        <span>${item?.vbs_charges}</span>
                                                     </div>
                                                    <div>
                                                        Express Charges:<br/>
                                                        <span>${item?.express_charges}</span>
                                                     </div>
                                                    <div>
                                                        Authority Fee:<br/>
                                                        <span>${item?.authority_fee}</span>
                                                     </div>
                                                    <div>
                                                        Visa Fee:<br/>
                                                        <span>${item?.visa_fee}</span>
                                                     </div>
                                                    <div>
                                                        Vendor Name:<br/>
                                                        <span>${item?.vendor_name}</span>
                                                     </div>
                                                    <div>
                                                        Handover Date:<br/>
                                                        <span>${new Date(item?.handover_date).toDateString()}</span>
                                                     </div>
                                                    <div>
                                                        Visa Status:<br/>
                                                        <span>${item?.visa_status}</span>
                                                     </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>`)}
                                    ${data?.data[2].map(item => `<div class="uk-card uk-card-default" style="height: 82px; background: #F5F5F5; border-radius: 18px; padding: 3%;">
                                        <div uk-grid class="uk-child-width-1-4" style="justify-content: space-between;">
                                            <div style="color: #000000;">${item?.travel_client_ref?.client_name}</div>
                                            <div style="width: 140px; border-radius: 8px; display: flex; background: #E56509; color: white; align-items: center;"><span style="block">Packages</span></div>
                                            <div style="display: flex; justify-content: center; align-items: center; color: #000000;">${item?.stage}</div>
                                            <div style="display: flex; justify-content: center; align-items: center;"><img class="btn" uk-toggle="target: #package-application-details-modal-${item?.id}"  src="{% static 'img/carbon_arrow-up-black.png' %}" style="width:32px; height:32px;" /></div>
                                        </div>
                                        <div id="package-application-details-modal-${item?.id}" uk-modal>
                                            <div class="uk-modal-dialog uk-modal-body">
                                                <button class="uk-modal-close-default" type="button" uk-close></button>
                                                <h2 class="uk-modal-title">Application details</h2>
                                                <input type="hidden" id="id_employee" value=""/>
                                                <div uk-grid class="uk-child-width-1-2">
                                                    <div>
                                                        Applicants Name:<br/>
                                                        <span>${item?.applicants_name}</span>
                                                     </div>
                                                    <div>
                                                        Package Type:<br/>
                                                        <span>${item?.package_type}</span>
                                                     </div>
                                                    <div>
                                                        Quantity of Packages:<br/>
                                                        <span>${item?.quantity_of_packages}</span>
                                                     </div>
                                                     <div>
                                                        Package Name:<br/>
                                                        <span>${item?.package_name}</span>
                                                     </div>
                                                     <div>
                                                        Number of Days:<br/>
                                                        <span>${item?.no_of_days}</span>
                                                     </div>
                                                     ${item?.passport_no && `<div>
                                                        Passport Number:<br/>
                                                        <span>${item?.passport_no}</span>
                                                     </div>`}
                                                    <div>
                                                        Stage:<br/>
                                                        <span>${item?.stage}</span>
                                                     </div>
                                                    <div>
                                                        Application Status:<br/>
                                                        <span>${item?.status}</span>
                                                     </div>
                                                    <div>
                                                        Invoice Status:<br/>
                                                        <span>${item?.invoice_status ? "Paid": "Unpaid"}</span>
                                                     </div>
                                                    <div>
                                                        Total Charges:<br/>
                                                        <span>${item?.net_amount}</span>
                                                     </div>
                                                    <div>
                                                        Gross Amount:<br/>
                                                        <span>${item?.gross_amount}</span>
                                                     </div>
                                                    <div>
                                                        Service Fees:<br/>
                                                        <span>${item?.service_fees}</span>
                                                     </div>
                                                    <div>
                                                        Total Vendor Payment:<br/>
                                                        <span>${item?.total_vendor_payment}</span>
                                                     </div>
                                                    <div>
                                                        Vendor Name:<br/>
                                                        <span>${item?.vendor_name}</span>
                                                     </div>
                                                    <div>
                                                        Tentative Payment Date:<br/>
                                                        <span>${new Date(item?.tentative_payment_date).toDateString()}</span>
                                                     </div>
                                                    <div>
                                                        Arrival Date:<br/>
                                                        <span>${new Date(item?.arrival_date).toDateString()}</span>
                                                     </div>
                                                    <div>
                                                        Departure Date:<br/>
                                                        <span>${new Date(item?.departure_date).toDateString()}</span>
                                                     </div>
                                                    <div>
                                                        Destination:<br/>
                                                        <span>${item?.destination}</span>
                                                     </div>
                                                    <div>
                                                        Boarding:<br/>
                                                        <span>${item?.boarding}</span>
                                                     </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>`)}
                                    ${data?.data[3].map(item => `<div class="uk-card uk-card-default" style="height: 82px; background: #F5F5F5; border-radius: 18px; padding: 3%;">
                                        <div uk-grid class="uk-child-width-1-4" style="justify-content: space-between;">
                                            <div style="color: #000000;">${item?.travel_client_ref?.client_name}</div>
                                            <div style="width: 130px; border-radius: 8px; display: flex; background: #BD08EA; color: white; align-items: center;"><span style="block">Tickets</span></div>
                                            <div style="display: flex; justify-content: center; align-items: center; color: #000000;">${item?.stage}</div>
                                            <div style="display: flex; justify-content: center; align-items: center;"><img class="btn" uk-toggle="target: #ticket-application-details-modal-${item?.id}" src="{% static 'img/carbon_arrow-up-black.png' %}" style="width:32px; height:32px;" /></div>
                                        </div>
                                        <div id="ticket-application-details-modal-${item?.id}" uk-modal>
                                            <div class="uk-modal-dialog uk-modal-body">
                                                <button class="uk-modal-close-default" type="button" uk-close></button>
                                                <h2 class="uk-modal-title">Application details</h2>
                                                <input type="hidden" id="id_employee" value=""/>
                                                <div uk-grid class="uk-child-width-1-2">
                                                    <div>
                                                        Applicants Name:<br/>
                                                        <span>${item?.applicants_name}</span>
                                                     </div>
                                                    <div>
                                                        Package Type:<br/>
                                                        <span>${item?.package_type}</span>
                                                     </div>
                                                    <div>
                                                        Contact Number:<br/>
                                                        <span>${item?.contact_number}</span>
                                                     </div>
                                                     <div>
                                                        Package Name:<br/>
                                                        <span>${item?.package_name}</span>
                                                     </div>
                                                     <div>
                                                        Trip Type:<br/>
                                                        <span>${item?.trip_type}</span>
                                                     </div>
                                                    <div>
                                                        Stage:<br/>
                                                        <span>${item?.stage}</span>
                                                     </div>
                                                    <div>
                                                        Application Status:<br/>
                                                        <span>${item?.status}</span>
                                                     </div>
                                                    <div>
                                                        Invoice Status:<br/>
                                                        <span>${item?.invoice_status ? "Paid": "Unpaid"}</span>
                                                     </div>
                                                    <div>
                                                        Total Charges:<br/>
                                                        <span>${item?.total_amount}</span>
                                                     </div>
                                                    <div>
                                                        Gross Amount:<br/>
                                                        <span>${item?.gross_amount}</span>
                                                     </div>
                                                    <div>
                                                        Service Fees:<br/>
                                                        <span>${item?.service_fees}</span>
                                                     </div>
                                                    <div>
                                                        Ticket Number:<br/>
                                                        <span>${item?.ticket_no}</span>
                                                     </div>
                                                    <div>
                                                        Agent Ref:<br/>
                                                        <span>${item?.agent_ref}</span>
                                                     </div>
                                                    <div>
                                                        Issued From:<br/>
                                                        <span>${item?.issued_from}</span>
                                                     </div>
                                                    <div>
                                                        Travel Class:<br/>
                                                        <span>${item?.travel_class}</span>
                                                     </div>
                                                    <div>
                                                        Vehicle Number:<br/>
                                                        <span>${item?.vehicle_no}</span>
                                                     </div>
                                                    <div>
                                                        mode of Transport:<br/>
                                                        <span>${item?.mode_of_transport}</span>
                                                     </div>
                                                    <div>
                                                        Arrival Date:<br/>
                                                        <span>${new Date(item?.arrival_date).toDateString()}</span>
                                                     </div>
                                                    <div>
                                                        Departure Date:<br/>
                                                        <span>${new Date(item?.departure_date).toDateString()}</span>
                                                     </div>
                                                    <div>
                                                        Destination:<br/>
                                                        <span>${item?.destination}</span>
                                                     </div>
                                                    <div>
                                                        Boarding:<br/>
                                                        <span>${item?.origin}</span>
                                                     </div>
                                                    <div>
                                                        Via:<br/>
                                                        <span>${item?.via}</span>
                                                     </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>`)}                                    
                                </div>
                            </div>`
                        }


                        if(data?.data[4].length === 0){

                            pending_applications.style = "gap: 1.5rem; list-style:none; justify-content: center;"

                            pending_applications.innerHTML = `<div style="text-align: center;">
                                <img src="{% static 'img/la_hand-pointer.png' %}" style="width:50px; height:50px; margin-bottom: 1rem;" /><br/>
                                <span style="font-size:1.5rem; color: #D0D0D0; width: 100%; display: inline-block;">
                                    No pending applications at the moment.<br /> Please try again later.
                                </span>
                            </div>`
                        } else {

                            pending_applications.style = "gap: 1.5rem; list-style:none; justify-content: flex-start;"

                            pending_applications.innerHTML = data?.data[4].map(item => `<li>
                                <div style="height: 120px; padding: 20px; color: white; background: #FE6666; min-width: 305px; display: flex; align-items: flex-start; justify-content: center; border-radius: 21px">
                                    <div class="uk-flex" style="flex-direction:column">
                                        <div class="uk-flex" style="justify-content: space-between; gap: 1rem;">
                                            <label style="font-size: 140%;">Client Name:</label>
                                            <label style="font-size: 140%; text-transform: capitalize;">${item?.name}</label>
                                        </div>
                                        <div style="vertical-align: middle;">
                                            <label style="font-size: 180%;">${item?.count} Pending</label>
                                        </div>
                                    </div>
                                </div>
                            </li>`)

                            /* pending_applications.innerHTML = data?.data[4].map(item => `<li>
                                <div style="height: 120px; padding: 20px; color: white; background: #FE6666; min-width: 305px; display: flex; align-items: flex-start; justify-content: center; border-radius: 21px">
                                    <div class="uk-flex" style="flex-direction:column">
                                        <div class="uk-flex" style="justify-content: space-between; gap: 3rem;">
                                            <label style="font-size: 140%;">${item?.name}</label>
                                            <button class="alert-btn"><img src="{% static 'img/fluent_mail-16-filled.png' %}" style="width:27px; height:27px;">Alert</button>
                                        </div>
                                        <div style="vertical-align: middle;">
                                            <label style="font-size: 180%;">${item?.count} Pending</label>
                                        </div>
                                    </div>
                                </div>
                            </li>`)*/ 
                        }

                        if(data?.data[5].length === 0){

                            application_payment.style = "gap: 1.5rem; list-style:none; justify-content: center;"

                            application_payment.innerHTML = `<div style="text-align: center;">
                                <img src="{% static 'img/la_hand-pointer.png' %}" style="width:50px; height:50px; margin-bottom: 1rem;" /><br/>
                                <span style="font-size:1.5rem; color: #D0D0D0; width: 100%; display: inline-block;">
                                    No applications at payment stage.<br /> Please try again later.
                                </span>
                            </div>` 
                        }else{

                            application_payment.style = "gap: 1.5rem; list-style:none; justify-content: flex-start;"

                            application_payment.innerHTML =  data?.data[5].map(item => `<li>
                                <div style="height: 120px; padding: 20px; color: white; background: #22BF7D; min-width: 305px; display: flex; align-items: flex-start; justify-content: center; border-radius: 21px">
                                    <div class="uk-flex" style="flex-direction:column">
                                        <div class="uk-flex" style="justify-content: space-between; gap: 3rem;">
                                            <label style="font-size: 140%;">${item?.name}</label>
                                            <button class="alert-btn"><img src="{% static 'img/fluent_mail-16-filled.png' %}" style="width:27px; height:27px;">Alert</button>
                                        </div>
                                        <div style="vertical-align: middle;">
                                            <label style="font-size: 180%;">${item?.count} Pending</label>
                                        </div>
                                    </div>
                                </div>
                            </li>`)
                        }



                    },
                    error: function(jqXHR, exception){
                        console.log(jqXHR, ' | ', exception);
                        alertbox.innerHTML = "It seems server side erro has occured. Try again after some time. Still if problem persist, contact developer@vsbizz.com";
                    },        
                })
            } 
        }
    </script>
{% endblock content %}